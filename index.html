<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minimal Blog App</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header>
    <h1>üìù Blog App</h1>
  </header>

  <main>
    <!-- Create New Post -->
    <section id="create-post">
      <h2>Create New Post</h2>
      <form id="postForm">
        <input type="text" id="title" placeholder="Title" required />
        <textarea id="content" placeholder="Write your blog content..." required></textarea>
        <input type="text" id="author" placeholder="Author" required />
        <input type="text" id="tags" placeholder="Tags (comma separated)" />
        <label>
          <input type="checkbox" id="published" />
          Publish Now
        </label>
        <button type="submit">Submit</button>
      </form>
    </section>

    <!-- Blog Posts -->
    <section id="posts">
      <h2>All Blog Posts</h2>
      <div id="postsContainer"></div>
    </section>
  </main>

  <footer>
    <p>¬© 2025 Blog App</p>
  </footer>

  <script>
    const API_URL = "/api/posts";

    async function fetchPosts() {
      const res = await fetch(API_URL);
      const posts = await res.json();
      const container = document.getElementById("postsContainer");
      container.innerHTML = "";
      posts.forEach(post => {
        const card = document.createElement("div");
        card.className = "post-card";
        card.innerHTML = `
          <h3>${post.title}</h3>
          <p class="meta">By ${post.author} ‚Ä¢ ${new Date(post.createdAt).toLocaleString()}</p>
          <p>${post.content.substring(0, 200)}...</p>
          <p class="tags">Tags: ${post.tags.join(", ")}</p>
          <p>Status: <strong>${post.published ? "Published ‚úÖ" : "Draft üöß"}</strong></p>
          <button onclick="togglePublish('${post._id}')">Toggle Publish</button>
          <button onclick="deletePost('${post._id}')">Delete</button>
        `;
        container.appendChild(card);
      });
    }

    async function deletePost(id) {
      if (!confirm("Are you sure you want to delete this post?")) return;
      await fetch(`${API_URL}/${id}`, { method: "DELETE" });
      fetchPosts();
    }

    async function togglePublish(id) {
      await fetch(`${API_URL}/${id}/toggle-publish`, { method: "PATCH" });
      fetchPosts();
    }

    document.getElementById("postForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const newPost = {
        title: document.getElementById("title").value,
        content: document.getElementById("content").value,
        author: document.getElementById("author").value,
        tags: document.getElementById("tags").value,
        published: document.getElementById("published").checked,
      };
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(newPost)
      });
      e.target.reset();
      fetchPosts();
    });

    fetchPosts();
  </script>
</body>
</html>
